<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Admin Self-Check</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .pass { color: #0f0; }
        .fail { color: #f00; }
        pre { background: #000; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>🧪 Admin Panel Self-Check</h1>
    <pre id="output">Test başlatılıyor...</pre>
    
    <script>
    (async () => {
        const output = document.getElementById('output');
        const log = (ok, msg) => {
            const icon = ok ? '✅' : '❌';
            const cls = ok ? 'pass' : 'fail';
            output.innerHTML += `<span class="${cls}">${icon} ${msg}</span>\n`;
        };
        
        output.innerHTML = '';
        
        // 1) DOM Kontrolleri
        log(true, '=== DOM KONTROLLERI ===');
        log(!!document.getElementById('otpScreen'), 'OTP bileşeni (parent page)');
        log(!!document.getElementById('dashboardScreen'), 'Dashboard bileşeni (parent page)');
        log(!!document.getElementById('callScreen'), 'Call screen bileşeni (parent page)');
        
        // 2) CSS/JS Yükleme
        log(true, '\n=== CSS/JS KONTROLLERI ===');
        const cssHrefs = [...document.styleSheets].map(s => s.href).filter(Boolean);
        log(cssHrefs.length >= 0, `CSS dosyaları yüklü (${cssHrefs.length})`);
        log(typeof window.notify?.show === 'function', 'NotificationManager aktif');
        log(typeof window.callUser === 'function', 'callUser() tanımlı');
        log(!!document.querySelector('script[src*="signaling.js"]'), 'signaling.js bağlandı');
        
        // 3) API Uçları
        log(true, '\n=== API KONTROLLERI ===');
        const api = async (p) => {
            try {
                const res = await fetch(p, {credentials: 'include'});
                return res.ok;
            } catch {
                return false;
            }
        };
        
        log(await api('/healthz'), '/healthz erişilebilir');
        log(await api('/api/check-session'), '/api/check-session erişilebilir');
        log(await api('/api/active-calls'), '/api/active-calls erişilebilir');
        log(await api('/api/call-logs'), '/api/call-logs erişilebilir');
        
        // 4) WebRTC Desteği
        log(true, '\n=== WEBRTC KONTROLLERI ===');
        log(!!window.RTCPeerConnection, 'RTCPeerConnection destekleniyor');
        log(!!navigator.mediaDevices, 'MediaDevices API mevcut');
        log(!!navigator.mediaDevices.getUserMedia, 'getUserMedia mevcut');
        
        // 5) İzinler
        log(true, '\n=== İZİN KONTROLLERI ===');
        try {
            const p1 = await navigator.permissions.query({name: 'camera'});
            const p2 = await navigator.permissions.query({name: 'microphone'});
            log(true, `Kamera: ${p1.state} / Mikrofon: ${p2.state}`);
        } catch {
            log(true, 'Permissions API desteklenmiyor (sorun değil)');
        }
        
        // 6) Sonuç
        output.innerHTML += '\n<span class="pass">🎉 Self-check tamamlandı!</span>\n';
        output.innerHTML += '\nTarayıcı konsolunu kontrol edin (F12)';
    })();
    </script>
</body>
</html>
