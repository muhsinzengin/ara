<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Admin Self-Check</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .pass { color: #0f0; }
        .fail { color: #f00; }
        pre { background: #000; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Admin Panel Self-Check</h1>
    <pre id="output">Test baÅŸlatÄ±lÄ±yor...</pre>
    
    <script>
    (async () => {
        const output = document.getElementById('output');
        const log = (ok, msg) => {
            const icon = ok ? 'âœ…' : 'âŒ';
            const cls = ok ? 'pass' : 'fail';
            output.innerHTML += `<span class="${cls}">${icon} ${msg}</span>\n`;
        };
        
        output.innerHTML = '';
        
        // 1) DOM Kontrolleri
        log(true, '=== DOM KONTROLLERI ===');
        log(!!document.getElementById('otpScreen'), 'OTP bileÅŸeni (parent page)');
        log(!!document.getElementById('dashboardScreen'), 'Dashboard bileÅŸeni (parent page)');
        log(!!document.getElementById('callScreen'), 'Call screen bileÅŸeni (parent page)');
        
        // 2) CSS/JS YÃ¼kleme
        log(true, '\n=== CSS/JS KONTROLLERI ===');
        const cssHrefs = [...document.styleSheets].map(s => s.href).filter(Boolean);
        log(cssHrefs.length >= 0, `CSS dosyalarÄ± yÃ¼klÃ¼ (${cssHrefs.length})`);
        log(typeof window.notify?.show === 'function', 'NotificationManager aktif');
        log(typeof window.callUser === 'function', 'callUser() tanÄ±mlÄ±');
        log(!!document.querySelector('script[src*="signaling.js"]'), 'signaling.js baÄŸlandÄ±');
        
        // 3) API UÃ§larÄ±
        log(true, '\n=== API KONTROLLERI ===');
        const api = async (p) => {
            try {
                const res = await fetch(p, {credentials: 'include'});
                return res.ok;
            } catch {
                return false;
            }
        };
        
        log(await api('/healthz'), '/healthz eriÅŸilebilir');
        log(await api('/api/check-session'), '/api/check-session eriÅŸilebilir');
        log(await api('/api/active-calls'), '/api/active-calls eriÅŸilebilir');
        log(await api('/api/call-logs'), '/api/call-logs eriÅŸilebilir');
        
        // 4) WebRTC DesteÄŸi
        log(true, '\n=== WEBRTC KONTROLLERI ===');
        log(!!window.RTCPeerConnection, 'RTCPeerConnection destekleniyor');
        log(!!navigator.mediaDevices, 'MediaDevices API mevcut');
        log(!!navigator.mediaDevices.getUserMedia, 'getUserMedia mevcut');
        
        // 5) Ä°zinler
        log(true, '\n=== Ä°ZÄ°N KONTROLLERI ===');
        try {
            const p1 = await navigator.permissions.query({name: 'camera'});
            const p2 = await navigator.permissions.query({name: 'microphone'});
            log(true, `Kamera: ${p1.state} / Mikrofon: ${p2.state}`);
        } catch {
            log(true, 'Permissions API desteklenmiyor (sorun deÄŸil)');
        }
        
        // 6) SonuÃ§
        output.innerHTML += '\n<span class="pass">ğŸ‰ Self-check tamamlandÄ±!</span>\n';
        output.innerHTML += '\nTarayÄ±cÄ± konsolunu kontrol edin (F12)';
    })();
    </script>
</body>
</html>
